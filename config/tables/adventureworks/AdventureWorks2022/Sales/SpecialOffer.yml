table:
  source: adventureworks
  database: AdventureWorks2022
  source_schema: Sales
  source_table: SpecialOffer
  target_name: specialoffer
  enabled: true
  execution_order: 5

  load:
    type: full
    primary_key: [SpecialOfferID]
    fetch_size: 1000

  schema_drift:
    mode: strict
    alert_on_drift: true
    allowed_changes: [add_column]

  quality:
    expectations:
      - name: "offer_id_not_null"
        constraint: "SpecialOfferID IS NOT NULL"
        action: fail
      - name: "valid_discount"
        constraint: "DiscountPct >= 0"
        action: warn
      - name: "valid_date_range"
        constraint: "StartDate <= EndDate"
        action: warn

  silver:
    transformations:
      - type: add_column
        name: is_active
        expression: "CASE WHEN current_date() BETWEEN StartDate AND EndDate THEN true ELSE false END"
      - type: trim_strings
        columns: all
    scd_type: 1
    merge_keys: [SpecialOfferID]
