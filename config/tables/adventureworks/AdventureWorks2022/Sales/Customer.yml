table:
  source: adventureworks
  database: AdventureWorks2022
  source_schema: Sales
  source_table: Customer
  target_name: customer
  enabled: true
  execution_order: 10

  load:
    type: incremental
    watermark_column: ModifiedDate
    primary_key: [CustomerID]
    fetch_size: 10000

  schema_drift:
    mode: auto_evolve
    alert_on_drift: true
    allowed_changes: [add_column]

  quality:
    expectations:
      - name: "customer_id_not_null"
        constraint: "CustomerID IS NOT NULL"
        action: fail
      - name: "valid_territory"
        constraint: "TerritoryID IS NOT NULL AND TerritoryID > 0"
        action: warn
      - name: "valid_account_number"
        constraint: "AccountNumber IS NOT NULL AND LENGTH(AccountNumber) > 0"
        action: drop

  silver:
    transformations:
      - type: add_column
        name: customer_type
        expression: "CASE WHEN StoreID IS NULL THEN 'Individual' ELSE 'Store' END"
      - type: add_column
        name: source_system
        expression: "'AdventureWorks'"
      - type: trim_strings
        columns: all
      - type: null_standardize
        values: ["NULL", "null", "N/A", "n/a", ""]
    scd_type: 1
    merge_keys: [CustomerID]

  schedule:
    cron: "0 0 6 * * ?"
    timezone: "America/New_York"
