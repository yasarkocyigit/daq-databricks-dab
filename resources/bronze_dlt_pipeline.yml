resources:
  pipelines:
    bronze_ingestion:
      name: "MDI_Bronze_Ingestion_${var.environment}"
      catalog: "${var.catalog}"
      target: "${var.bronze_raw_schema}"
      libraries:
        - notebook:
            path: ../src/bronze/bronze_dlt.py
      configuration:
        environment: ${var.environment}
        catalog: ${var.catalog}
        bronze_raw_schema: ${var.bronze_raw_schema}
        bronze_storage_path: ${var.bronze_storage_path}
        bronze_raw_prefix: ${var.bronze_raw_prefix}
        bronze_state_prefix: ${var.bronze_state_prefix}
        control_schema: ${var.control_schema}
        secret_scope: ${var.secret_scope}
        checkpoint_base: ${var.checkpoint_base}
      channel: PREVIEW
      continuous: false
      development: false
      clusters:
        - label: default
          num_workers: ${var.num_workers}
          node_type_id: Standard_D4s_v3
          spark_conf:
            spark.sql.adaptive.enabled: "true"
            spark.databricks.delta.schema.autoMerge.enabled: "true"
      photon: true
